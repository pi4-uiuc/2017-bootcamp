---
title: Exploratory Data Analysis
author: ~
date: '2017-05-31'
slug: exploratory-data-analysis
categories: []
tags: []
---



### Data Cleaning
   * Data Cleaning with Open Refine [DC lesson 1-4](http://www.datacarpentry.org/OpenRefine-ecology-lesson/)
   * Data Cleaning in R

### Data Manipulation

   * [filtering, subsetting, summarizing, new variables with dplyr](http://swcarpentry.github.io/r-novice-gapminder/13-dplyr/)
   * [Converting data from wide to long with tidyr](http://swcarpentry.github.io/r-novice-gapminder/14-tidyr/)

## Access via PostgreSQL

```{r}
library(dplyr)

bety_src <- src_postgres(dbname = "bety", 
                password = 'bety', 
                host = 'terra-bety.default', 
                user = 'bety', 
                port = 5432)

```


### filtering / subsetting

```{r}

traits <- tbl(bety_src, 'traits', n=Inf)

variables <- tbl(bety_src, 'variables') %>%
  mutate(variable_id = id)

sites <- tbl(bety_src, 'sites') %>%
  mutate(site_id = id)

traits_variables <- traits %>% 
  left_join(variables, by = 'variable_id') %>% 
  left_join(sites, by = 'site_id') %>% 
  select(sitename, name, mean) %>% 
  filter(name == 'canopy_height') %>% 
  collect()

#spread(traits_variables, key = sitename, value = mean)
```

### filtering / subsetting

```{r}

traits <- tbl(bety_src, 'traits', n=Inf)

variables <- tbl(bety_src, 'variables') %>%
  mutate(variable_id = id)

sites <- tbl(bety_src, 'sites') %>%
  mutate(site_id = id)

#cultivars <- tbl(bety_src, 'cultivars') %>%
#  mutate(cultivar_id = id, cultivar = 'name')

traits_variables <- traits %>% 
  left_join(variables, by = 'variable_id') %>%
  left_join(sites, by = 'site_id') %>% 
  select(sitename, date, name, mean, cultivar_id) %>% 
  filter(name == 'canopy_height') %>% collect

traits_variables_season_2 <- traits_variables %>%
    filter(grepl("Season 2",sitename))

```

### grouping and summarizing

```{r}
traits_variables_season_2 %>% 
  group_by(date) %>% 
  summarize(mean = mean(mean), n =n())

canopy_heights <- traits_variables_season_2 %>% 
  group_by(date, cultivar_id) %>% 
  summarize(mean = mean(mean), n =n())


```


### Plotting with ggplot

```{r}
library(ggplot2)

ggplot(data = traits_variables_season_2,
       aes(x = date, y = mean, group = cultivar_id)) +
  geom_smooth(se = FALSE, alpha = 0.25, size = 0.5) +
  geom_point(alpha = 0.25, size = 0.5, position = 'jitter')


```


```{r}

### filter a subset of 25 genotypes
height_season_2_subset <- traits_variables_season_2 %>% 
  filter(cultivar_id < min(traits_variables_season_2$cultivar_id)+25)

# how many unique values of cultivar_id?

#height_season_2_subset %>% group_by(cultivar_id, date) %>% summarize(n())


ggplot(data = height_season_2_subset,
       aes(x = date, y = mean, color = as.factor(cultivar_id))) +
  geom_smooth(se = FALSE, alpha = 0.25, size = 0.5) +
  geom_point(alpha = 0.25, size = 0.5)

```

### Faceting

```{r}
ggplot(data = height_season_2_subset,
       aes(x = date, y = mean)) +
  geom_smooth(se = FALSE) +
  geom_point() +
  facet_wrap(~cultivar_id) +
  ggthemes::theme_tufte()

# geom_boxplot
# geom_violin
# geom_histogram


ggplot(data = height_season_2_subset,
       aes(mean, fill = date)) +
  geom_histogram() +
  facet_wrap(~cultivar_id) +
  theme_bw()
```


### Visualization in R using ggplot

* R for data science http://r4ds.had.co.nz/data-visualisation.html
* [SWC 8](http://swcarpentry.github.io/r-novice-gapminder/08-plot-ggplot2/)

```{r}

```